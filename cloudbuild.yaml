steps:
- name: "gcr.io/cloud-builders/npm"
  args: ["install"]
  dir: "/workspace/myapp"  # Specify the correct directory where package.json is located

- name: "gcr.io/cloud-builders/npm"
  args: ["test"]
  dir: "/workspace/myapp/tests"  # Make sure to use the same directory for testing

- name: "gcr.io/cloud-builders/gcloud"
  args: ["app", "deploy"]
  dir: "/workspace/myapp"  # Use the same directory for deploying
  entrypoint: "bash"  # Use a shell to set the service account
  env:
    - 'CLOUDSDK_AUTH_CREDENTIAL_FILE=/path/to/your/credential-file.json'  # Provide the path to your service account key file
  serviceAccount: 'cloudbuild-sa@my-project-51512-402616.iam.gserviceaccount.com'
# Add other steps as needed